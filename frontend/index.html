<!doctype html>
<html>
	<head>
		<meta name='viewport' content='width=300px;initial-scale=1.0'>
		<style>



#_SEND_CONTENT_ {
	font-size: 16px;
	width: 95%;
}



		</style>
	</head>
	<body>
		<input type='button' value='LIGHT' id='_LIGHT_'>
		<input type='button' value='DARK' id='_DARK_'>
		<div id="_TEST_"></div>
		<div id='_APP_'>
			<div> <b> WebSocket </b> </div>
			<div id='_ONLINE_'>
				<span>received data:&nbsp;</span>
				<div id='_RECEIVED_'></div>
			</div>
			<div id='_SEND_BOARD_'>
				<hr />
				<p style="text-align:right;"><input
					type='button'
					value='SEND'
					id='_SEND_CONFIRM_'></p>
				<p><input
					type='text'
					id='_SEND_CONTENT_'></p>
				<hr />
			</div>
		</div>
		<script type='text/javascript'>


_DARK_.onclick = function () {
	document.body.style.backgroundColor = "#000";
	document.body.style.color = "#fff";
};
_LIGHT_.onclick = function () {
	document.body.style.backgroundColor = "#fff";
	document.body.style.color = "#000";
};
if (window.WebSocket != undefined) {
	//change the abs-url to document.host:
	var ws_conn = new WebSocket("ws://" + document.location.host + "/ws");
	_TEST_.innerHTML += "<p> +++ client-WebSocket </p>";
	ws_conn.onopen = function () {
		var json_msg = {
			"source_node":"",
			"description":"user-login",
			"content":[]
		};
		_TEST_.innerHTML += "<p>+++ Server-websocket</p>";
		//ws_conn.send("_NEW_CLIENT_"); // will be a json. //should get rid of this line.
		ws_conn.send(JSON.stringify(json_msg)); // will be a json.

		_RECEIVED_.innerHTML += ("<p>Connection Opened.</p>");
	};
	ws_conn.onmessage = function(e) {
		//e.data will be jsonlified later on.
		_RECEIVED_.innerHTML += ("<p>" + e.data + "</p>"); //test mode.
		/*
		var msg_content = JSON.parse(e.data);
		msg_content = msg_content["content"]; // now, msg_content is a string array.
		for (var i = 0; i < msg_content.length; i++) {
			_RECEIVED_.innerHTML += ("<p>" + msg_content[i] + "</p>");
		}
		*/

	};
	ws_conn.onerror = function (e) {
		_TEST_.innerHTML += ("<p>" + e.data + "</p>");
	};
	ws_conn.onclose = function () {
		//The sever crash???
		//ws_conn has been closed in this time.
		_TEST_.innerHTML += "<p> ~~~ </p>";
		_RECEIVED_.innerHTML += ("<p>Connection Closed.</p>");
	};
	//To allow the user to send the messages by pressing enter.
	_SEND_CONTENT_.onkeyup = function (e) {
		e = e || windows.event;
		e = e.keyCode || e.which;
		if (e === 13) {
			_SEND_CONFIRM_.onclick();
			_SEND_CONTENT_.click();
		}
	};
	_SEND_CONFIRM_.onclick = function () {
		var json_msg = {
			"source_node":"",
			"description":"user-msg-text",
			"content":[]
		};
		if (_SEND_CONTENT_.value != '') {
			json_msg["content"].push(_SEND_CONTENT_.value);
			ws_conn.send(JSON.stringify(json_msg));
			_SEND_CONTENT_.value = '';
			_SEND_CONTENT_.click();
			_SEND_CONTENT_.focus();
		}
	};
} else {
	_TEST_.innerHTML += (
		"<p>No WebSocket Util Supported. </p>" 
		+"<p> 肥肠抱歉~ 您的浏览器是个战五渣呢。</p>"
		+"<p> 强烈建议您使用谷歌浏览器或者火狐浏览器。</p>"
	);
}



		</script>
	</body>
</html>
